# AI.md

This file provides guidance to AI agents working with this repository.

## Project Overview

**Tech Stack:** Electron (Forge + Vite) • React 19 + TypeScript (strict) • TanStack Router • Tailwind CSS v4 + coss.ui (Base UI) • oRPC + Zod (typed IPC) • Biome • Vitest + Playwright

**Related Docs:**
- [`docs/FILE-STRUCTURE.md`](docs/FILE-STRUCTURE.md) — Detailed directory structure documentation

## Quick Reference

### Commands
| Command | Purpose |
|---------|---------|
| `bun run dev` | Run the app (Electron Forge) |
| `bun run fix` | Auto-fix + re-check (Biome) |
| `bun run verify` | fix + unit tests |
| `bun run verify-full` | fix + unit tests + build + docs |
| `bun run test` | Unit tests (Vitest) |
| `bun run test:e2e` | E2E tests (Playwright) |
| `bun run docs` | Regenerate structure docs |
| `bun run build` | Build installers |

### Key Paths
| Path | Purpose |
|------|---------|
| `src/main/` | Main process code |
| `src/preload/` | Preload scripts |
| `src/renderer/` | React UI code |
| `src/ipc/` | IPC handlers (main-side) |
| `src/actions/` | IPC wrappers (renderer-side) |
| `src/shared/` | Cross-process types/constants |
| `src/routes/` | File-based routing (TanStack) |
| `src/styles/global.css` | Global CSS styles |

## Architecture Overview

### Process Entry Points
Entry files (`src/main.ts`, `src/preload.ts`, `src/renderer.ts`) should only delegate to their respective modules. All logic lives in the delegated files.

### IPC Architecture (oRPC)
- **Main-side:** `src/ipc/<domain>/` — schemas, handlers, router
- **Renderer-side:** `src/actions/<domain>.ts` — typed wrappers
- Both sides must evolve together; update in the same PR

## Process Boundaries (Mandatory)

### Import Rules
| Process | May Import | Cannot Import |
|---------|------------|---------------|
| **Main** (`src/main/**`) | `electron`, `node:*`, `src/shared/**`, `src/ipc/**` | `src/renderer/**`, `src/preload/**`, `src/routes/**`, `src/actions/**` |
| **Preload** (`src/preload/**`) | `electron` (contextBridge/ipcRenderer only), `src/shared/**` | `src/main/**`, `src/renderer/**`, `src/ipc/**`, `src/actions/**` |
| **Renderer** (`src/renderer/**`, `src/routes/**`) | `react`, `src/shared/**`, `src/actions/**`, `src/renderer/**` | `src/main/**`, `src/preload/**`, `src/ipc/**`, Node/Electron APIs |

### Security Posture
- `contextIsolation: true` — **MANDATORY**, never disable
- `nodeIntegration: false` — **MANDATORY**, never enable
- `sandbox: true` — **RECOMMENDED** for all windows
- All renderer-to-main communication via IPC only

## Architecture Guidelines

### Routes (`src/routes/`)
Routes are **thin composition files** — layout + wiring only. Complex UI logic lives in `src/renderer/features/`.

### Shared Code (`src/shared/`)
**What goes here:** Types, constants, pure functions (no Electron/DOM dependencies)
**What doesn't:** React components, Electron wrappers, DOM utilities

## Conventions

### Path Aliases
- `@/` resolves to `src/` (see `tsconfig.json`)

### File Guidelines
- Keep files under 300 lines; split when exceeding scope
- Limit to 3 concerns per file; extract helpers for clarity
- Extract shared logic after 2+ uses
- No barrel files (`index.ts` re-exports) unless explicitly needed (Biome enforces)

### Component Promotion
Keep components in feature folders until used by 2+ features, then extract to `src/renderer/components/`

### Generated Files
- `src/routeTree.gen.ts` — Auto-generated by TanStack Router; don't hand-edit

## Agent Workflow

1. **Before changes:** Search for existing utilities/components under `src/` and extend where appropriate
2. **After changes:** Run `bun run fix` to auto-fix and verify
3. **Before PRs:** Run `bun run verify`
4. **Before releases:** Run `bun run verify-full`

Always resolve any linting or type errors before completing a task.

## Source Tree

> Auto-generated by `bun run docs`. Do not edit manually.

<!-- AUTO-GENERATED TREE START -->

```
actions/ # 10 files
  ├─ ai.ts # AI IPC wrappers for renderer
  ├─ app.ts # App info IPC wrappers for renderer
  ├─ automation.ts # Automation IPC wrappers for renderer
  ├─ language.ts # Language preference management for renderer
  ├─ notifications.ts # Notifications IPC wrappers for renderer
  ├─ settings.ts # Settings IPC wrappers for renderer
  ├─ shell.ts # Shell operations IPC wrapper for renderer
  ├─ shortcuts.ts # Shortcuts IPC wrappers for renderer
  ├─ theme.ts # Theme mode management for renderer
  └─ window.ts # Window control IPC wrappers for renderer
ipc/ # 3 files, 9 directories
  ├─ ai/ # 3 files
  │ ├─ handlers.ts # AI IPC handlers
  │ ├─ router.ts # AI domain router
  │ └─ schemas.ts # Zod schemas for AI IPC
  ├─ app/ # 3 files
  │ ├─ handlers.ts # App info IPC handlers
  │ ├─ router.ts # App domain router
  │ └─ schemas.ts # Zod schemas for app IPC
  ├─ automation/ # 3 files
  │ ├─ handlers.ts # Automation IPC handlers
  │ ├─ router.ts # Automation domain router
  │ └─ schemas.ts # Zod schemas for automation IPC
  ├─ notifications/ # 3 files
  │ ├─ handlers.ts # Notifications IPC handlers
  │ ├─ router.ts # Notifications domain router
  │ └─ schemas.ts # Zod schemas for notifications IPC
  ├─ settings/ # 3 files
  │ ├─ handlers.ts # Settings IPC handlers
  │ ├─ router.ts # Settings domain router
  │ └─ schemas.ts # Zod schemas for settings IPC
  ├─ shell/ # 3 files
  │ ├─ handlers.ts # Shell operations IPC handlers
  │ ├─ router.ts # Shell domain router
  │ └─ schemas.ts # Zod schemas for shell IPC
  ├─ shortcuts/ # 3 files
  │ ├─ handlers.ts # Shortcuts IPC handlers
  │ ├─ router.ts # Shortcuts domain router
  │ └─ schemas.ts # Zod schemas for shortcuts IPC
  ├─ theme/ # 3 files
  │ ├─ handlers.ts # Theme mode IPC handlers
  │ ├─ router.ts # Theme domain router
  │ └─ schemas.ts # Zod schemas for theme IPC
  ├─ window/ # 3 files
  │ ├─ handlers.ts # Window control IPC handlers
  │ ├─ router.ts # Window domain router
  │ └─ schemas.ts # Zod schemas for window IPC
  ├─ context.ts # IPC context with main window reference and window manager
  ├─ handler.ts # oRPC handler for main process
  └─ router.ts # Root oRPC router combining all domains
main/ # 1 files, 6 directories
  ├─ ai/ # 3 files
  │ ├─ client.ts # Google Gemini AI client
  │ ├─ error-handler.ts # AI error handling utilities
  │ └─ prompts.ts # Role-based prompt templates
  ├─ automation/ # 2 files
  │ ├─ clipboard.ts # Clipboard backup/restore utilities
  │ └─ keyboard.ts # nut-js wrapper for keyboard automation
  ├─ shortcuts/ # 2 files
  │ ├─ handlers.ts # Fix selection/field orchestration handlers
  │ └─ manager.ts # Global shortcut registration manager
  ├─ storage/ # 4 files
  │ ├─ api-keys.ts # safeStorage wrapper for API key encryption
  │ ├─ context.ts # In-memory edit context storage
  │ ├─ notifications.ts # 5 exports
  │ └─ settings.ts # electron-store instance for persistent settings
  ├─ tray/ # 1 file
  │ └─ tray-manager.ts # System tray lifecycle management
  ├─ windows/ # 1 file
  │ └─ window-manager.ts # Centralized window lifecycle management
  └─ app.ts # Main process lifecycle and initialization
preload/ # 1 file
  └─ bridge.ts # IPC bridge via contextBridge
renderer/ # 1 files, 5 directories
  ├─ components/ # 6 files, 1 directories
  │ ├─ ui/ # 50 files
  │ │ ├─ accordion.tsx # 5 exports
  │ │ ├─ alert-dialog.tsx # 13 exports
  │ │ ├─ alert.tsx # 4 exports
  │ │ ├─ autocomplete.tsx # 15 exports
  │ │ ├─ avatar.tsx # 3 exports
  │ │ ├─ badge.tsx # 2 exports
  │ │ ├─ breadcrumb.tsx # 7 exports
  │ │ ├─ button.tsx # 2 exports
  │ │ ├─ card.tsx # 8 exports
  │ │ ├─ checkbox-group.tsx # 1 export
  │ │ ├─ checkbox.tsx # 1 export
  │ │ ├─ collapsible.tsx # 4 exports
  │ │ ├─ combobox.tsx # 17 exports
  │ │ ├─ command.tsx # 15 exports
  │ │ ├─ dialog.tsx # 14 exports
  │ │ ├─ empty.tsx # 6 exports
  │ │ ├─ field.tsx # 6 exports
  │ │ ├─ fieldset.tsx # 2 exports
  │ │ ├─ form.tsx # 1 export
  │ │ ├─ frame.tsx # 6 exports
  │ │ ├─ group.tsx # 7 exports
  │ │ ├─ input-group.tsx # 5 exports
  │ │ ├─ input.tsx # 2 exports
  │ │ ├─ kbd.tsx # 2 exports
  │ │ ├─ label.tsx # 1 export
  │ │ ├─ menu.tsx # 30 exports
  │ │ ├─ meter.tsx # 5 exports
  │ │ ├─ number-field.tsx # 6 exports
  │ │ ├─ pagination.tsx # 7 exports
  │ │ ├─ popover.tsx # 8 exports
  │ │ ├─ preview-card.tsx # 6 exports
  │ │ ├─ progress.tsx # 5 exports
  │ │ ├─ radio-group.tsx # 3 exports
  │ │ ├─ scroll-area.tsx # 2 exports
  │ │ ├─ select.tsx # 9 exports
  │ │ ├─ separator.tsx # 1 export
  │ │ ├─ sheet.tsx # 13 exports
  │ │ ├─ sidebar.tsx # 24 exports
  │ │ ├─ skeleton.tsx # 1 export
  │ │ ├─ slider.tsx # 2 exports
  │ │ ├─ spinner.tsx # 1 export
  │ │ ├─ switch.tsx # 1 export
  │ │ ├─ table.tsx # 8 exports
  │ │ ├─ tabs.tsx # 6 exports
  │ │ ├─ textarea.tsx # 2 exports
  │ │ ├─ toast.tsx # 5 exports
  │ │ ├─ toggle-group.tsx # 4 exports
  │ │ ├─ toggle.tsx # 2 exports
  │ │ ├─ toolbar.tsx # 6 exports
  │ │ └─ tooltip.tsx # 6 exports
  │ ├─ drag-window-region.tsx # Draggable title bar with window controls
  │ ├─ error-boundary.tsx # React error boundary with recovery UI
  │ ├─ external-link.tsx # External link button using shell API
  │ ├─ lang-toggle.tsx # Language selection toggle group
  │ ├─ notification-center.tsx # 1 export
  │ └─ toggle-theme.tsx # Theme toggle button component
  ├─ features/ # 1 directory
  │ └─ settings/ # 1 file
  │   └─ settings-form.tsx # Settings form component
  ├─ hooks/ # 2 files
  │ ├─ use-mobile.ts # 1 export
  │ └─ use-notification-listener.ts # 1 export
  ├─ layouts/ # 1 file
  │ └─ base-layout.tsx # Base layout with title bar region
  ├─ lib/ # 6 files
  │ ├─ i18n.ts # i18next configuration and translations
  │ ├─ ipc-manager.ts # IPC client manager for renderer process
  │ ├─ langs.ts # Supported language definitions
  │ ├─ language.ts # Language type definition
  │ ├─ routes.ts # TanStack Router configuration Uses hash history to support multiple Electron windows with independent routes. Each window can load with a different hash (e.g., #/popup, #/settings) and the router will initialize to that route automatically. Memory history would force all windows to start at the same initial route.
  │ └─ tailwind.ts # Tailwind CSS class merging utility
  └─ app.tsx # React application root and mounting
routes/ # 3 files
  ├─ __root.tsx # Root route with base layout wrapper
  ├─ index.tsx # Dashboard page route component
  ├─ popup.tsx # Popup chat route component
  └─ settings.tsx # Settings page route component
shared/ # 3 directories
  ├─ config/ # 1 file
  │ └─ ai-models.ts # Centralized AI model configuration This is the single source of truth for all available models
  ├─ contracts/ # 1 file
  │ └─ ipc-channels.ts # IPC channel names and storage keys
  └─ types/ # 6 files
    ├─ ai.ts # AI types
    ├─ automation.ts # Automation types
    ├─ notifications.ts # 3 exports
    ├─ settings.ts # Settings schema types
    ├─ shortcuts.ts # Hotkey types
    └─ theme.ts # Theme mode type definition
tests/ # 1 directory
  └─ unit/ # 1 file
    └─ setup.ts # Vitest setup with jest-dom matchers
main.ts # Electron main process entrypoint
preload.ts # Preload script entrypoint
renderer.ts # Renderer process entrypoint
routeTree.gen.ts # 6 exports
```

<!-- AUTO-GENERATED TREE END -->
